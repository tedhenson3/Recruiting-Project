#fresh <- 1
for(j in 1:length(my.end.indices2)){
# end <- strsplit(test.start, "all_")
# end <- paste(".", j, sep = "")
# final.table.name <- paste(table.name, end, sep = "")
#
# final.table.name <- stri_replace_all_regex(pattern = '".20', replacement =  '.20', str = final.table.name)
#
#  end = stri_replace_all_regex(str = end, pattern = '\"', replacement = '"')
# end.index <- grep(end, need)
end <- my.end.indices2[j]
advanced <- as.character(need[1:end])
table <- advanced[length(advanced)]
year <- strsplit(table, ".", fixed = T)
season <- strsplit(year[[1]][2], '\"', fixed = T)
my.season <- season[[1]][1]
stat.split <- strsplit(table, "data-stat=")
next.split <- strsplit(stat.split[[1]], '>', fixed = T)
#career.data <- data.frame()
mydata <- data.frame()
flipped.data <- data.frame()
for(i in 5:length(next.split)){
mystat <- next.split[[i]][2]
stat.name <- next.split[[i]][1]
stat.name <- gsub('"', '', stat.name, fixed = T)
stat.name <- gsub(" ", "", stat.name, fixed = T)
stat.name <- paste(stat.name, table.name, sep = ".")
# colval1 <- paste('value.', my.season, sep = '')
#
#
# colval2 <- paste('stat.', my.season, sep = '')
#stat.name <- paste(stat.name, my.season, sep = '.')
if(grepl("conf", table.name) == T){
#colnames(flipped.data) <- paste("conf", colnames(flipped.data), sep = ".")
stat.name <- paste(stat.name, "conf", sep = ".")
}
value <- as.numeric(gsub("</td", "", mystat, fixed = T))
# mydata[i-4, colval1] <- value
#
# mydata[i-4, colval2] <- stat.name
flipped.data[1, stat.name] <- value
flipped.data[1, 'season'] <- as.numeric(my.season)
row.names(flipped.data) <- NULL
flipped.data <- as.data.frame(flipped.data)
#see <- nest(flipped.data)
final.table.name <- paste(table.name, my.season, sep = "")
assign(final.table.name, flipped.data)
#overall.data[j,k] <- as.data.frame(see)
#colnames(overall.data)[k] <- table.name
}
j <- as.numeric(j)
if(k == 1 & j == 1){
overall.data <- flipped.data
}
if(k == 1 & j > 1){
overall.data <- rbind(flipped.data, overall.data)
}
if(k > 1 & j == 1){
#newrow <- cbind(overall.data[1,], flipped.data)
first.data <- flipped.data
}
if(k > 1 & j < nrow(overall.data)){
first.data <- rbind(flipped.data, first.data)
}
if(k > 1 & j == nrow(overall.data)){
overall.data <- cbind(overall.data, first.data)
}
}
}
finish <- cbind(player.data, overall.data)
return(finish)
}
url <- c("https://www.sports-reference.com/cbb/players/marvin-bagleyiii-1.html")
#
cash <- sports.ref.scraper(url)
View(cash)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
View(espn.247)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
# setwd("C:/Users/tedhe/Onedrive/Documents/recruiting project")
# thing <- c("https://www.sports-reference.com/cbb/players/gary-trentjr-1.html")
#notes on weird player tags for sports reference url#
#1 Marvin Bagley III = marvin-bagleyiii-1
#2 Gary Trent Jr. = gary-trentjr-1
#3 M.J. Walker = mj-walker-1
#4 Silvio De Sousa = silvio-desousa-1
#5 Shai Gilgeous-Alexander = shai-gilgeous-alexander-1
#6 Nickeil Alexander-Walker = nickeil-alexander-walker-1
wsscraper <- function(data){
source("~/analytics/recruiting project/sports.ref.scraper.R")
fulldata <- data.frame()
bad.links <- 0
for(i in 1:nrow(data)){
url <- as.character(data[i, 'bball.ref.link.espn'])
# url <- gsub("jaren-jackson", "jaren-jacksonjr", url)
#
# url <- gsub("wendell-carter", "wendell-carterjr", url)
library(tidyverse)
library(rvest)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
#bio.data$bball.ref.player.id <- data[i, 'player.id']
}
if(grepl(data[i, 'School'], bio.data$College) != T | class(link) == "try-error"){
j <- 2
while(j < 10){
old.num <- paste(j-1, '.html', sep = "")
new.num <- paste(j, '.html', sep = "")
url <- gsub(old.num, new.num, url)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
}
if(grepl(data[i, 'School'], bio.data$College) == T){
j <- 10
}
if(grepl(data[i, 'School'], bio.data$College) != T){
j <- j + 1
}
}
}
reset.url <- as.character(data[i, 'bball.ref.link.espn'])
if(grepl('jr-1', reset.url) == T){
url <- gsub('jr-', '-', reset.url)
if(grepl(data[i, 'School'], bio.data$College) != T | class(link) == "try-error"){
j <- 1
while(j < 10){
old.num <- paste(j-1, '.html', sep = "")
new.num <- paste(j, '.html', sep = "")
url <- gsub(old.num, new.num, url)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
}
if(grepl(data[i, 'School'], bio.data$College) == T){
j <- 10
}
if(grepl(data[i, 'School'], bio.data$College) != T){
j <- j + 1
}
}
}
}
reset.url <- as.character(data[i, 'bball.ref.link.espn'])
if(grepl('jr-1', reset.url) != T){
url <- gsub('-1.html', 'jr-1.html', reset.url)
if(grepl(data[i, 'School'], bio.data$College) != T | class(link) == "try-error"){
j <- 1
while(j < 10){
old.num <- paste(j-1, '.html', sep = "")
new.num <- paste(j, '.html', sep = "")
url <- gsub(old.num, new.num, url)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
}
if(grepl(data[i, 'School'], bio.data$College) == T){
j <- 10
}
if(grepl(data[i, 'School'], bio.data$College) != T){
j <- j + 1
}
}
}
}
if(bio.data$College == data[i, 'School']){
# lastcol <- as.numeric(ncol(bio.data) + length(data[i,]))
# full.row <- cbind(data[i,], bio.data)
# fulldata <- rbind(fulldata, full.row)
fulldata <- cbind(bio.data, data[i,])
View(fulldata)
}
}
return(fulldata)
}
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
# setwd("C:/Users/tedhe/Onedrive/Documents/recruiting project")
# thing <- c("https://www.sports-reference.com/cbb/players/gary-trentjr-1.html")
#notes on weird player tags for sports reference url#
#1 Marvin Bagley III = marvin-bagleyiii-1
#2 Gary Trent Jr. = gary-trentjr-1
#3 M.J. Walker = mj-walker-1
#4 Silvio De Sousa = silvio-desousa-1
#5 Shai Gilgeous-Alexander = shai-gilgeous-alexander-1
#6 Nickeil Alexander-Walker = nickeil-alexander-walker-1
wsscraper <- function(data){
source("~/analytics/recruiting project/sports.ref.scraper.R")
fulldata <- data.frame()
bad.links <- 0
for(i in 1:nrow(data)){
url <- as.character(data[i, 'bball.ref.link.espn'])
# url <- gsub("jaren-jackson", "jaren-jacksonjr", url)
#
# url <- gsub("wendell-carter", "wendell-carterjr", url)
library(tidyverse)
library(rvest)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
#bio.data$bball.ref.player.id <- data[i, 'player.id']
}
if(grepl(data[i, 'School'], bio.data$College) != T | class(link) == "try-error"){
j <- 2
while(j < 10){
old.num <- paste(j-1, '.html', sep = "")
new.num <- paste(j, '.html', sep = "")
url <- gsub(old.num, new.num, url)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
}
if(grepl(data[i, 'School'], bio.data$College) == T){
j <- 10
}
if(grepl(data[i, 'School'], bio.data$College) != T){
j <- j + 1
}
}
}
reset.url <- as.character(data[i, 'bball.ref.link.espn'])
if(grepl('jr-1', reset.url) == T){
url <- gsub('jr-', '-', reset.url)
if(grepl(data[i, 'School'], bio.data$College) != T | class(link) == "try-error"){
j <- 1
while(j < 10){
old.num <- paste(j-1, '.html', sep = "")
new.num <- paste(j, '.html', sep = "")
url <- gsub(old.num, new.num, url)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
}
if(grepl(data[i, 'School'], bio.data$College) == T){
j <- 10
}
if(grepl(data[i, 'School'], bio.data$College) != T){
j <- j + 1
}
}
}
}
reset.url <- as.character(data[i, 'bball.ref.link.espn'])
if(grepl('jr-1', reset.url) != T){
url <- gsub('-1.html', 'jr-1.html', reset.url)
if(grepl(data[i, 'School'], bio.data$College) != T | class(link) == "try-error"){
j <- 1
while(j < 10){
old.num <- paste(j-1, '.html', sep = "")
new.num <- paste(j, '.html', sep = "")
url <- gsub(old.num, new.num, url)
link <- try(readLines(url))
if(class(link) != "try-error"){
bio.data <- sports.ref.scraper(url)
}
if(grepl(data[i, 'School'], bio.data$College) == T){
j <- 10
}
if(grepl(data[i, 'School'], bio.data$College) != T){
j <- j + 1
}
}
}
}
if(bio.data$College == data[i, 'School']){
# lastcol <- as.numeric(ncol(bio.data) + length(data[i,]))
# full.row <- cbind(data[i,], bio.data)
# fulldata <- rbind(fulldata, full.row)
see <- cbind(bio.data, data[i,])
View(see)
}
}
return(see)
}
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
View(espn.247)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
#write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
#write.csv(data, file = 'successfull.scrapes.csv', row.names = F)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
espn.247$School <- gsub("N Carolina", "UNC", espn.247$School)
espn.247$School <- gsub("Miss. St", "Mississippi State", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
espn.247$School <- gsub("W Kentucky", "Western Kentucky", espn.247$School)
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
