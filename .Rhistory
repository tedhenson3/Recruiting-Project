espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
ncol(data)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
colnames(fulldata)
colnames(data)
data
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
View(data)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
View(data)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
# setwd("C:/Users/tedhe/Onedrive/Documents/recruiting project")
# thing <- c("https://www.sports-reference.com/cbb/players/gary-trentjr-1.html")
#notes on weird player tags for sports reference url#
#1 Marvin Bagley III = marvin-bagleyiii-1
#2 Gary Trent Jr. = gary-trentjr-1
#3 M.J. Walker = mj-walker-1
#4 Silvio De Sousa = silvio-desousa-1
#5 Shai Gilgeous-Alexander = shai-gilgeous-alexander-1
#6 Nickeil Alexander-Walker = nickeil-alexander-walker-1
wsscraper <- function(data){
fulldata <- data.frame()
for(i in 1:nrow(data)){
url <- data[i, 'bball.ref.link.espn']
library(tidyverse)
library(rvest)
link <- try(readLines(url))
if(class(link) == "try-error"){
player.ref <- gsub('-1.html', '-2.html', url)
}
else{
player.ref <- url
}
css_tags <- 'p , h1'
stats = player.ref %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
# if(is.na(bio.end)){
#
#   url <- gsub('-1.html', '-2.html', url)
#   stats = url %>%
#     read_html() %>%
#     html_nodes(css=css_tags) %>% html_text()
#
#   print(stats)
#
#   end <- grepl('School:', stats)
#
#   real.end <- which(end == T)
#   bio.end <- real.end[2]
#
# }
end <- grepl('School:', stats)
real.end <- which(end == T)
bio.end <- real.end[2]
if(!is.na(bio.end)){
}
else{
url <- gsub('-1', 'jr-1', url)
stats = url %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
end <- grepl('School:', stats)
real.end <- which(end == T)
bio.end <- real.end[2]
}
bio <- stats[1:bio.end]
#View(bio)
bio <- gsub("\n", "", bio, fixed = T)
end <- grepl('Position:', bio)
real. <- which(end == T)
bio.end <- real.end[2]
player.data <- data.frame("Name" = bio[1], "Position" = bio[2], "Height.Weight" = bio[3],
"Hometown" = bio[4], "High.School" = bio[5],
"College" = bio[length(bio)])
player.data$Position = gsub("Position:", "", player.data$Position)
player.data$Hometown = gsub("Hometown:", "", player.data$Hometown)
player.data$High.School = gsub("High School:", "", player.data$High.School)
player.data$College = gsub("School:", "", player.data$College)
#player.data$RSCI.Rating = gsub("School:", "", player.data$College)
player.data$College <- str_trim(player.data$College)
player.data$player.id <- data[i, 'player.id']
#colnames(player.data) <- paste('bball.ref', colnames(player.data), sep = ".")
#need to remove leading blanks in espn dataset
if(player.data$College == data[i, 'School']){
lastcol <- as.numeric(ncol(player.data) + length(data[i,]))
full.row <- cbind(data[i,], player.data)
fulldata <- rbind(fulldata, full.row)
}
View(fulldata)
}
#return(fulldata)
}
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
#football url
# url_247 <- c("https://247sports.com/Season/2018-Football/CompositeCompositeRecruitRankings/?InstitutionGroup=highschool")
pg_url_247 <- c("https://247sports.com/Season/2017-Basketball/CompositeRecruitRankings/?InstitutionGroup=highschool&Position=PG")
url_247 <- c("https://247sports.com/Season/2017-Basketball/CompositeRecruitRankings/?InstitutionGroup=highschool")
library(tidyverse)
library(rvest)
css_tags <- '.score , .other , .position , .rank , .sttrank , .posrank , .natrank , .hw , .rankings-page__name-link , .meta , .metrics , .pos , .name'
rankings_2018 = url_247 %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
#View(rankings_2018)
#mycolnames <- rankings_2018[1:5]
rankings_2018 <- rankings_2018[6:length(rankings_2018)]
indices <- seq(from = 1, to = length(rankings_2018), by = 10)
clean.data <- data.frame(matrix(ncol = 10, nrow = 0))
for(i in 1:c(length(indices)-1)){
start <- indices[i]
end <- indices[i+1] - 1
row <- rankings_2018[start:end]
clean.data[i,] <- row
}
colnames(clean.data) <- c("Previous.National.Ranking", "Name", "Hometown", "Position",
"Height.Weight", "Rating", "All Ratings", "National.Ranking",
"Position.Ranking", "State.Ranking")
for(i in 1:length(clean.data$Name)){
player <- clean.data[i, 'Name']
lower.player <- tolower(player)
lower.player <- gsub(" jr.", "jr", lower.player, fixed = T)
lower.player <- gsub(" sr.", "sr", lower.player, fixed = T)
lower.player <- gsub(" iii", "iii", lower.player, fixed = T)
lower.player <- gsub(" ii", "ii", lower.player, fixed = T)
lower.player <- gsub(" iv", "iv", lower.player, fixed = T)
lower.player <- gsub(".", "", lower.player, fixed = T)
first.last <- strsplit(lower.player, ' ')
#print(first.last)
clean.data[i, 'player.id'] <- paste(first.last[[1]][1:length(first.last[[1]])], collapse = "-")
}
poslist <- c("PG", "SG", "CG", "SF", "PF", "C")
clean.data$bball.ref.link = paste("https://www.sports-reference.com/cbb/players/", clean.data$player.id, "-1.html",
sep = "")
rankings.247 <- clean.data
print(rankings.247)
# team.tag = '.png" title="'
#
#
# teams = readLines(pg_url_247)
#
# top.50.pos = grep('ViewPath=', teams)
#
# teams <- teams[1:top.50.pos]
#View(teams)
View(rankings.247)
View(rankings.espn)
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
data <- wsscraper(data = espn.247)
choose(5, 3)
10*6
24*24*2
factorial(24)*factorial(24)*2
factorial(4)*factorial(4)*2
factorial(5)
120/12
factorial(4) / 4
factorial(5) / 12
choose(13,10)
choose(12,10)
66*2
286-132
42.62 / 2
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(espn.247)
ted$jeff <- 0
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
playerdata['college'] <- 'ted'
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
data
fulldata
library(tidyverse)
library(rvest)
sports.ref.scraper <- function(player.ref){
library(tidyverse)
library(rvest)
css_tags <- 'p , h1'
stats = player.ref %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
end <- grepl('School:', stats)
real.end <- which(end == T)
bio.end <- real.end[2]
if(is.na(bio.end)){
player.data <- data.frame("College" = c(0))
player.data$College <- 'miss'
print('yes')
}
else{
bio <- stats[1:bio.end]
print(bio)
bio <- gsub("\n", "", bio, fixed = T)
end <- grepl('Position:', bio)
real.end <- which(end == T)
bio.end <- real.end[2]
player.data <- data.frame("Name" = bio[1], "Position" = bio[2], "Height.Weight" = bio[3],
"Hometown" = bio[4], "High.School" = bio[5],
"College" = bio[length(bio)])
player.data$Position = gsub("Position:", "", player.data$Position)
player.data$Hometown = gsub("Hometown:", "", player.data$Hometown)
player.data$High.School = gsub("High School:", "", player.data$High.School)
player.data$College = gsub("School:", "", player.data$College)
#player.data$RSCI.Rating = gsub("School:", "", player.data$College)
player.data$College <- str_trim(player.data$College)
}
#colnames(player.data) <- paste("bball.ref.", colnames(player.data), sep = "")
#print(player.data)
return(player.data)
}
url <- c("https://www.sports-reference.com/cbb/players/blake-harris-1.html")
sports.ref.scraper(url)
library(tidyverse)
library(rvest)
sports.ref.scraper <- function(player.ref){
library(tidyverse)
library(rvest)
css_tags <- 'p , h1'
stats = player.ref %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
end <- grepl('School:', stats)
real.end <- which(end == T)
bio.end <- real.end[2]
if(is.na(bio.end)){
player.data <- data.frame("College" = c(0))
player.data$College <- 'miss'
print('yes')
}
else{
bio <- stats[1:bio.end]
print(bio)
bio <- gsub("\n", "", bio, fixed = T)
end <- grepl('Position:', bio)
real.end <- which(end == T)
bio.end <- real.end[2]
player.data <- data.frame("Name" = bio[1], "Position" = bio[2], "Height.Weight" = bio[3],
"Hometown" = bio[4], "High.School" = bio[5],
"College" = bio[length(bio)])
player.data$Position = gsub("Position:", "", player.data$Position)
player.data$Hometown = gsub("Hometown:", "", player.data$Hometown)
player.data$High.School = gsub("High School:", "", player.data$High.School)
player.data$College = gsub("School:", "", player.data$College)
#player.data$RSCI.Rating = gsub("School:", "", player.data$College)
player.data$College <- str_trim(player.data$College)
}
#colnames(player.data) <- paste("bball.ref.", colnames(player.data), sep = "")
#print(player.data)
return(player.data)
}
url <- c("https://www.sports-reference.com/cbb/players/blake-harris-2.html")
sports.ref.scraper(url)
library(tidyverse)
library(rvest)
sports.ref.scraper <- function(player.ref){
library(tidyverse)
library(rvest)
css_tags <- 'p , h1'
stats = player.ref %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
end <- grepl('School:', stats)
real.end <- which(end == T)
bio.end <- real.end[2]
if(is.na(bio.end)){
player.data <- data.frame("College" = c(0))
player.data$College <- 'miss'
print('yes')
}
else{
bio <- stats[1:bio.end]
print(bio)
bio <- gsub("\n", "", bio, fixed = T)
end <- grepl('Position:', bio)
real.end <- which(end == T)
bio.end <- real.end[2]
player.data <- data.frame("Name" = bio[1], "Position" = bio[2], "Height.Weight" = bio[3],
"Hometown" = bio[4], "High.School" = bio[5],
"College" = bio[length(bio)])
player.data$Position = gsub("Position:", "", player.data$Position)
player.data$Hometown = gsub("Hometown:", "", player.data$Hometown)
player.data$High.School = gsub("High School:", "", player.data$High.School)
player.data$College = gsub("School:", "", player.data$College)
#player.data$RSCI.Rating = gsub("School:", "", player.data$College)
player.data$College <- str_trim(player.data$College)
}
#colnames(player.data) <- paste("bball.ref.", colnames(player.data), sep = "")
#print(player.data)
return(player.data)
}
url <- c("https://www.sports-reference.com/cbb/players/blake-harris-2.html")
sports.ref.scraper(url)
library(tidyverse)
library(rvest)
sports.ref.scraper <- function(player.ref){
library(tidyverse)
library(rvest)
css_tags <- 'p , h1'
stats = player.ref %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
end <- grepl('School:', stats)
real.end <- which(end == T)
bio.end <- real.end[2]
if(is.na(bio.end)){
player.data <- data.frame("College" = c(0))
player.data$College <- 'miss'
print('yes')
}
else{
bio <- stats[1:bio.end]
print(bio)
bio <- gsub("\n", "", bio, fixed = T)
end <- grepl('Position:', bio)
real.end <- which(end == T)
bio.end <- real.end[2]
player.data <- data.frame("Name" = bio[1], "Position" = bio[2], "Height.Weight" = bio[3],
"Hometown" = bio[4], "High.School" = bio[5],
"College" = bio[length(bio)])
player.data$Position = gsub("Position:", "", player.data$Position)
player.data$Hometown = gsub("Hometown:", "", player.data$Hometown)
player.data$High.School = gsub("High School:", "", player.data$High.School)
player.data$College = gsub("School:", "", player.data$College)
#player.data$RSCI.Rating = gsub("School:", "", player.data$College)
player.data$College <- str_trim(player.data$College)
}
#colnames(player.data) <- paste("bball.ref.", colnames(player.data), sep = "")
#print(player.data)
return(player.data)
}
url <- c("https://www.sports-reference.com/cbb/players/blake-harris-1.html")
sports.ref.scraper(url)
library(tidyverse)
library(rvest)
sports.ref.scraper <- function(player.ref){
library(tidyverse)
library(rvest)
css_tags <- 'p , h1'
stats = player.ref %>%
read_html() %>%
html_nodes(css=css_tags) %>% html_text()
end <- grepl('School:', stats)
real.end <- which(end == T)
bio.end <- real.end[2]
if(is.na(bio.end)){
end <- grepl('Schools:', stats)
real.end <- which(end == T)
bio.end <- real.end[1]
}
if(is.na(bio.end)){
player.data <- data.frame("College" = c(0))
player.data$College <- 'miss'
print('yes')
}
if(!is.na(bio.end)){
bio <- stats[1:bio.end]
print(bio)
bio <- gsub("\n", "", bio, fixed = T)
end <- grepl('Position:', bio)
real.end <- which(end == T)
bio.end <- real.end[2]
player.data <- data.frame("Name" = bio[1], "Position" = bio[2], "Height.Weight" = bio[3],
"Hometown" = bio[4], "High.School" = bio[5],
"College" = bio[length(bio)])
player.data$Position = gsub("Position:", "", player.data$Position)
player.data$Hometown = gsub("Hometown:", "", player.data$Hometown)
player.data$High.School = gsub("High School:", "", player.data$High.School)
player.data$College = gsub("School:", "", player.data$College)
#player.data$RSCI.Rating = gsub("School:", "", player.data$College)
player.data$College <- str_trim(player.data$College)
}
#colnames(player.data) <- paste("bball.ref.", colnames(player.data), sep = "")
#print(player.data)
return(player.data)
}
url <- c("https://www.sports-reference.com/cbb/players/blake-harris-1.html")
sports.ref.scraper(url)
setwd("~/analytics/recruiting project")
library(tidyverse)
library(readr)
rankings.espn <- read_csv(file = 'rankings.espn.csv')
rankings.247 <- read_csv(file = 'rankings.247.csv')
espn.247 <- full_join(rankings.espn, rankings.247, by = "player.id",
suffix = c(".espn", ".247"))
rownames(espn.247) <- NULL
#View(espn.247)
source("~/analytics/recruiting project/basketball reference win share scraper.R")
espn.247 <- espn.247 %>% filter(!is.na(Name.espn) & School != 'unknown')
data <- wsscraper(data = espn.247)
View(data)
write.csv(data, file = 'successfull.scrapes.csv')
